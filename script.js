let posts=[],activeTag=null;async function loadPosts(){try{const r=await fetch('posts/metadata.json');const d=await r.json();posts=d.posts||[];renderTagBar();renderPosts()}catch(e){document.getElementById('kirjoitukset').innerHTML='<div class="post-card">Kirjoitusten lataus ep√§onnistui.</div>'}}function renderTagBar(){const b=document.getElementById('tagBar');if(!b)return;b.innerHTML='';const s=new Set(posts.flatMap(p=>p.tags||[]));if(s.size===0)return;const all=document.createElement('button');all.className='tag'+(activeTag===null?' active':'');all.textContent='Kaikki';all.onclick=()=>{activeTag=null;renderPosts();highlightTags()};b.appendChild(all);s.forEach(t=>{const x=document.createElement('button');x.className='tag'+(activeTag===t?' active':'');x.textContent=t;x.onclick=()=>{activeTag=(activeTag===t?null:t);renderPosts();highlightTags()};b.appendChild(x)})}function highlightTags(){document.querySelectorAll('.tag').forEach(btn=>{if(btn.textContent==='Kaikki'){btn.classList.toggle('active',activeTag===null)}else{btn.classList.toggle('active',btn.textContent===activeTag)}})}function renderPosts(){const q=document.getElementById('search').value.toLowerCase().trim();const l=document.getElementById('kirjoitukset');l.innerHTML='';let f=posts.slice();if(activeTag)f=f.filter(p=>(p.tags||[]).includes(activeTag));if(q)f=f.filter(p=>p.title.toLowerCase().includes(q)||(p.excerpt||'').toLowerCase().includes(q));if(f.length===0){l.innerHTML='<div class="post-card">Ei tuloksia.</div>';return}f.sort((a,b)=>(a.date<b.date?1:-1));f.forEach(p=>{const e=document.createElement('article');e.className='post-card';const t=(p.tags||[]).map(t=>`<span class="pill">${t}</span>`).join(' ');e.innerHTML=`<a href="${p.url}"><h3>${p.title}</h3></a><div class="meta">${p.date}</div><p>${p.excerpt||''}</p><div class="tagsline">${t}</div>`;l.appendChild(e)})}document.addEventListener('DOMContentLoaded',()=>{loadPosts();document.getElementById('randomBtn')?.addEventListener('click',()=>{if(posts.length===0)return;const p=posts[Math.floor(Math.random()*posts.length)];window.location.href=p.url});let c=0;const d=document.querySelector('footer .dot');d?.addEventListener('click',()=>{c++;if(c===7){c=0;const h=document.createElement('a');h.href='posts/syvempi-tila.html';h.textContent='Syvempi tila';h.style.marginLeft='10px';h.style.color='var(--accent)';document.querySelector('footer.foot')?.appendChild(h)}});const logo=document.querySelector('.logo');const about=document.getElementById('aboutModal');logo?.addEventListener('click',e=>{e.preventDefault();about?.showModal()});document.getElementById('search').addEventListener('input',renderPosts)});